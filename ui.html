<div id="content">
  <h3>How many players (1-7)?</h3>
  <label><input type='number' min='1' max='7' oninput='handleNumPlayersSelection(this);'> players</label>
  <input type="submit" onclick='generateTiles();' value="Generate tiles!">
  <h3>Select allowed directions</h3>
  <div class="directions">
    <label><input type='checkbox' data-direction='up' onclick='handleDirectionSelection(this);'>&uarr; up</label>
    <label><input type='checkbox' data-direction='down' onclick='handleDirectionSelection(this);'>&darr; down</label>
    <label><input type='checkbox' data-direction='left' onclick='handleDirectionSelection(this);'>&larr; left</label>
    <label><input type='checkbox' data-direction='right' onclick='handleDirectionSelection(this);'>&rarr; right</label>
  </div>
</div>

<script>
  var numPlayers = 0;

  const sendMessage = (type) => {
    parent.postMessage({ pluginMessage: { type: type }}, '*')
  }

  document.addEventListener('keydown', (e) => {
    switch (e.key) {
      case 'a':
      case 'ArrowLeft':
        sendMessage('move-left')
        break
      case 'd':
      case 'ArrowRight':
        sendMessage('move-right')
        break
      case 's':
      case 'ArrowDown':
        sendMessage('move-down')
        break
      case 'w':
      case 'ArrowUp':
        sendMessage('move-up')
        break
    }
  })

  const handleNumPlayersSelection = (input) => {
    numPlayers = input.value;
  }

  const generateTiles = () => {
    console.log(numPlayers)
    parent.postMessage({ pluginMessage: { type: 'generate-tiles', numPlayers: numPlayers }}, '*')
  }

  const handleDirectionSelection = (checkbox) => {
    const selected = checkbox.checked
    if (selected) {
      sendMessage(`select-${checkbox.dataset.direction}`)
    } else {
      sendMessage(`deselect-${checkbox.dataset.direction}`)
    }
  }

</script>

<style>
  .directions {
    display: flex;
    flex-direction: column;
  }
</style>
